<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Generator</title>
</head>
<body>
    <button id="generateBtn">Generate World</button>
    <pre id="result"></pre>
    <img id="worldImage" src="" alt="World Image" />
    <button id="saveBtn">Save World</button>
    <pre id="savedWorlds"></pre>

    <script>
        class WorldGenerator {
            constructor() {
                this.random = Math.random;
                this.savedWorlds = [];
            }

            roll2d6() {
                return Math.floor(this.random() * 6) + 1 + Math.floor(this.random() * 6) + 1;
            }

            roll1d6() {
                return Math.floor(this.random() * 6) + 1;
            }

            generateSize() {
                return this.roll2d6() - 2;
            }

            generateAtmosphere(size) {
                return this.roll2d6() - 7 + size;
            }

            generateHydrographics(size, atmosphere) {
                if (size <= 1) return 0;
                let hydrographics = this.roll2d6() - 7 + size;
                if (atmosphere === 0 || atmosphere === 1 || atmosphere === 10 || atmosphere >= 11) hydrographics -= 4;
                return Math.max(0, hydrographics);
            }

            generatePopulation() {
                return this.roll2d6() - 2;
            }

            generateGovernment(population) {
                return Math.max(0, this.roll2d6() - 7 + population);
            }

            generateLawLevel(government) {
                return Math.max(0, this.roll2d6() - 7 + government);
            }

            generateStarport() {
                const roll = this.roll2d6();
                if (roll <= 2) return 'X';
                else if (roll === 3 || roll === 4) return 'E';
                else if (roll === 5 || roll === 6) return 'D';
                else if (roll === 7 || roll === 8) return 'C';
                else if (roll === 9 || roll === 10) return 'B';
                else return 'A';
            }

            generateTechLevel(starport, size, atmosphere, hydrographics, population, government) {
                let techLevel = this.roll1d6();
                switch (starport) {
                    case 'A': techLevel += 6; break;
                    case 'B': techLevel += 4; break;
                    case 'C': techLevel += 2; break;
                    case 'X': techLevel -= 4; break;
                }
                if (size === 0 || size === 1) techLevel += 2;
                else if (size === 2 || size === 3 || size === 4) techLevel += 1;
                if ([0, 1, 2, 3, 10].includes(atmosphere)) techLevel += 1;
                if (hydrographics === 0) techLevel += 1;
                if (population === 0) return 0;
                else if (population === 1) techLevel += 1;
                else if ([2, 3, 4].includes(population)) techLevel += 1;
                else if ([8, 9].includes(population)) techLevel += 1;
                else if (population === 10) techLevel += 2;
                else if (population === 11) techLevel += 3;
                else if (population === 12) techLevel += 4;
                if (government === 0) techLevel += 1;
                else if (government === 5) techLevel += 1;
                else if (government === 7) techLevel += 2;
                else if ([13, 14].includes(government)) techLevel -= 2;
                return Math.max(0, techLevel);
            }

            getImage(size, atmosphere, hydrographics, population, government) {
                if (population > 10) return 'images/image1.jpg';
                else if (atmosphere < 5) return 'images/image2.jpg';
                else return 'images/image3.jpg';
            }

            generatePlanetName() {
                const syllables = ["ar", "an", "ra", "ta", "al", "el", "ur", "on", "il", "em"];
                const getRandomSyllable = () => syllables[Math.floor(this.random() * syllables.length)];
                return getRandomSyllable() + getRandomSyllable() + getRandomSyllable();
            }

            savePlanet(planet) {
                this.savedWorlds.push(planet);
                this.displaySavedWorlds();
            }

            displaySavedWorlds() {
                const savedWorldsElement = document.getElementById('savedWorlds');
                savedWorldsElement.textContent = this.savedWorlds.map(world => `${world.name}: ${world.details}`).join('\n\n');
            }

            main() {
                const size = this.generateSize();
                const atmosphere = this.generateAtmosphere(size);
                const hydrographics = this.generateHydrographics(size, atmosphere);
                const population = this.generatePopulation();
                const government = this.generateGovernment(population);
                const lawLevel = this.generateLawLevel(government);
                const starport = this.generateStarport();
                const techLevel = this.generateTechLevel(starport, size, atmosphere, hydrographics, population, government);
                const name = this.generatePlanetName();

                const result = `Name: ${name}\nSize: ${size}\nAtmosphere: ${atmosphere}\nHydrographics: ${hydrographics}\nPopulation: ${population}\nGovernment: ${government}\nLaw Level: ${lawLevel}\nStarport: ${starport}\nTech Level: ${techLevel}`;
                const imageUrl = this.getImage(size, atmosphere, hydrographics, population, government);

                return { name, result, imageUrl };
            }
        }

        const worldGenerator = new WorldGenerator();

        document.getElementById('generateBtn').addEventListener('click', () => {
            const { name, result, imageUrl } = worldGenerator.main();
            document.getElementById('result').textContent = result;
            document.getElementById('worldImage').src = imageUrl;
        });

        document.getElementById('saveBtn').addEventListener('click', () => {
            const { name, result } = worldGenerator.main();
            const planet = { name, details: result };
            worldGenerator.savePlanet(planet);
        });
    </script>
</body>
</html>
